var H=Object.create;var w=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var A=(e,r,n,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of B(r))!j.call(e,s)&&s!==n&&w(e,s,{get:()=>r[s],enumerable:!(t=W(r,s))||t.enumerable});return e};var c=(e,r,n)=>(n=e!=null?H(L(e)):{},A(r||!e||!e.__esModule?w(n,"default",{value:e,enumerable:!0}):n,e));var D=require("electron");var m=c(require("electron"));function g(){let e=["content-security-policy","access-control-allow-origin"];m.default.session.defaultSession.webRequest.onHeadersReceived((r,n)=>{Object.keys(r.responseHeaders).forEach(t=>{e.includes(t.toLowerCase())&&delete r.responseHeaders[t]}),r.responseHeaders["Access-Control-Allow-Origin"]=["*"],n({cancel:!1,responseHeaders:r.responseHeaders})})}var o=require("electron");function y(){o.ipcMain.on("GetPath",(e,r)=>{if(r==="appPath"){e.returnValue=o.app.getAppPath();return}try{e.returnValue=o.app.getPath(r)}catch{e.returnValue=null}}),o.ipcMain.on("Relaunch",()=>{o.app.quit(),o.app.relaunch()}),o.ipcMain.on("DevTools:Open",(e,r)=>{try{e.sender.openDevTools({mode:r,activate:!0})}catch{}}),o.ipcMain.on("DevTools:Close",e=>{try{e.sender.closeDevTools()}catch{}}),o.ipcMain.on("DevTools:Toggle",(e,r)=>{try{e.sender.isDevToolsOpened()?e.sender.closeDevTools():e.sender.openDevTools({mode:r,activate:!0})}catch{}}),o.ipcMain.on("RegisterPreload",(e,r)=>{try{o.dialog.showMessageBox(null,{message:r}),o.app.commandLine.appendSwitch("preload",r)}catch{}}),o.ipcMain.handle("ExecuteWindowScript",async(e,r)=>{try{return{ok:!0,data:await e.sender.executeJavaScript(`(() => {try {${r}} catch {}})();`,!0)}}catch(n){return{ok:!1,error:`${n}`}}}),o.ipcMain.handle("ExecuteInjectorScript",async(event,arg)=>{try{let res=await eval(`(() => {try {${arg}} catch {}})();`);return{ok:!0,data:res}}catch(e){return{ok:!1,error:`${e}`}}}),o.ipcMain.handle("ShowDialog",async(e,{mode:r="open",openDirectory:n=!1,openFile:t=!0,multiSelections:s=!1,filters:a,promptToCreate:l=!1,defaultPath:d,title:I,showOverwriteConfirmation:x,message:S,showHiddenFiles:C,modal:O=!1,buttons:_,defaultId:k,type:R,cancelId:T}={})=>{let h={open:o.dialog.showOpenDialog,save:o.dialog.showSaveDialog,message:o.dialog.showMessageBox}[r];return h?{ok:!1,data:await h.apply(o.dialog,[O&&o.BrowserWindow.fromWebContents(e.sender),{defaultPath:d,filters:a,title:I,message:S,createDirectory:!0,buttons:_,type:R,defaultId:k,cancelId:T,properties:[C&&"showHiddenFiles",n&&"openDirectory",l&&"promptToCreate",n&&"openDirectory",t&&"openFile",s&&"multiSelections",x&&"showOverwriteConfirmation"].filter(p=>p)}].filter(p=>p))}:{error:"Invalid mode.",ok:!1}}),o.ipcMain.handle("ShowWindow",(e,{url:r="",options:n=null,closeOnUrl:t=""}={})=>new Promise(s=>{let a=new o.BrowserWindow(n);if(a.loadURL(r),a.webContents.on("did-navigate",(l,d)=>{d==t&&(windowInstance.close(),s(a.id))}),!t)return s(a.id)}))}var P=c(require("electron"));function v(){P.default.session.fromPartition("default").setPermissionRequestHandler((e,r,n)=>{n(!0)})}var i=c(require("electron")),u=c(require("path")),f=c(require("fs"));function b(){class e extends i.default.BrowserWindow{constructor(t){if(t={...t,webPreferences:{...t?.webPreferences||{},nodeIntegration:!0,nodeIntegrationInSubFrames:!0,nodeIntegrationInWorker:!0,contextIsolation:!1,enableRemoteModule:!0,sandbox:!1}},!t||!t.webPreferences||!t.webPreferences.preload||!t.title)return super(t);let s=t.webPreferences.preload;t.webPreferences.preload=u.default.join(__dirname,"preload.js"),super(t),this.__ORIGINAL_PRELOAD__=s,process.env.ORIGINAL_DISCORD_PRELOAD=s,this.webContents.on("dom-ready",async()=>{let a=u.default.join(__dirname,"renderer.js");if(!f.default.existsSync(a))return;let l=f.default.readFileSync(a,"utf-8");i.default.dialog.showMessageBox(null,{message:"dom-ready"}),this.webContents.executeJavaScript(`(() => { try { ${l} return true; } catch (error) { console.error(error); return false; } })();`)}),this.webContents.on("did-navigate-in-page",()=>{this.webContents.send("NavigateInPage")})}}Object.assign(e,i.default.BrowserWindow);let r=require.resolve("electron");delete require.cache[r].exports,require.cache[r].exports={...i.default,BrowserWindow:e}}process.argv.includes("--original")||(process.env.NODE_OPTIONS="--no-force-async-hooks-checks",D.app.commandLine.appendSwitch("no-force-async-hooks-checks"),b(),v(),g(),y());
